{% extends "user_auth/base.html" %}
{% block content %}

<h2 class="text-3xl font-extrabold text-neutral-800 mb-3">Verify OTP</h2>
<p class="text-neutral-500 mb-6">
  Weâ€™ve sent a 6-digit OTP to <span class="font-bold text-neutral-800">{{ email }}</span>.
</p>

{% if error %}
<p class="text-red-600 mb-4 font-semibold">{{ error }}</p>
{% endif %}
{% if message %}
<p class="text-green-600 mb-4 font-semibold">{{ message }}</p>
{% endif %}

<!-- OTP Verification Form -->
<form method="POST" action="{{ url_for('otp.verify_otp') }}" class="space-y-4">
  <label class="block text-sm font-medium text-neutral-700 mb-1">Enter OTP</label>
  <input type="text" name="otp" maxlength="6" required
    class="w-full p-3 border border-neutral-300 rounded-lg focus:ring-blue-500"
    placeholder="Enter the 6-digit OTP">

  <!-- Hidden fields to preserve user data -->
  <input type="hidden" name="email" value="{{ email }}">
  <input type="hidden" name="username" value="{{ username }}">
  <input type="hidden" name="full_name" value="{{ full_name }}">
  <input type="hidden" name="phone_no" value="{{ phone_no }}">
  <input type="hidden" name="password" value="{{ password }}">

  <button type="submit"
    class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition">
    Verify & Create Account
  </button>
</form>

<!-- Resend OTP Form -->
<form method="POST" action="{{ url_for('otp.resend_otp') }}" class="text-center mt-6">
  <input type="hidden" name="email" value="{{ email }}">
  <input type="hidden" name="username" value="{{ username }}">
  <input type="hidden" name="full_name" value="{{ full_name }}">
  <input type="hidden" name="phone_no" value="{{ phone_no }}">
  <input type="hidden" name="password" value="{{ password }}">

  <button id="resendBtn" disabled
    class="text-blue-600 font-semibold hover:text-blue-800 disabled:opacity-50 disabled:cursor-not-allowed">
    Resend OTP (<span id="timer">5</span>s)
  </button>
</form>

<script>
  // 5-second cooldown for Resend button
  let timeLeft = 5;
  let timerEl = document.getElementById("timer");
  let btn = document.getElementById("resendBtn");

  let countdown = setInterval(() => {
    timeLeft--;
    timerEl.innerText = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(countdown);
      btn.disabled = false;
      btn.innerText = "Resend OTP";
    }
  }, 1000);
</script>

{% endblock %}
