{% extends "dashboard/base.html" %}
{% block title %}Account Settings{% endblock %}

{% block content %}
<div class="w-full px-6 py-8 max-w-4xl mx-auto">

    <!-- Page Title -->
    <h1 class="text-3xl font-bold text-neutral-900 mb-8 flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-neutral-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3 3 1.343 3 3zm0 0c0 1.657 1.343 3 3 3s3-1.343 3-3-1.343-3-3-3-3 1.343-3 3z" />
        </svg>
        Account Settings
    </h1>

    <form method="POST" enctype="multipart/form-data" class="space-y-8">

        <!-- Account Details Card -->
        <div class="bg-white shadow-lg rounded-xl p-6 space-y-6 border border-neutral-200">

            <h2 class="text-xl font-semibold text-neutral-800 mb-4">Account Details</h2>

            <!-- Username -->
            <div class="relative">
                <label class="block text-neutral-700 font-medium mb-1 flex items-center gap-1">
                    Username
                    <span class="relative group cursor-pointer text-neutral-500 font-bold">?
                        <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-neutral-800 text-white text-sm rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
                            Your username is unique and will be updated across your session if changed.
                        </span>
                    </span>
                </label>
                <input type="text" name="username" value="{{ current_user.username }}"
                       class="w-full border border-neutral-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300 text-neutral-800">
            </div>

            <!-- Primary Email (Read-only) -->
            <div class="relative">
                <label class="block text-neutral-700 font-medium mb-1 flex items-center gap-1">
                    Primary Email
                    <span class="relative group cursor-pointer text-neutral-500 font-bold">?
                        <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-neutral-800 text-white text-sm rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
                            This email is used for login and account notifications.
                        </span>
                    </span>
                </label>
                <input type="email" value="{{ current_user.email }}" readonly
                       class="w-full border border-neutral-300 rounded-lg px-4 py-2 bg-neutral-100 cursor-not-allowed text-neutral-400">
            </div>

            <!-- Additional Emails -->
            <div class="relative">
                <label class="block text-neutral-700 font-medium mb-1 flex items-center gap-1">
                    Additional Emails
                    <span class="relative group cursor-pointer text-neutral-500 font-bold">!
                        <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 bg-neutral-800 text-white text-sm rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
                            Add extra emails for password recovery or notifications.
                        </span>
                    </span>
                </label>
                <input type="email" name="email" placeholder="Add another email"
                       class="w-full border border-neutral-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300">
                {% if current_user.emails %}
                <p class="text-neutral-500 mt-1">Existing Emails: {{ current_user.emails | join(', ') }}</p>
                {% endif %}
            </div>

            <!-- Phone Number -->
            <div class="relative">
                <label class="block text-neutral-700 font-medium mb-1 flex items-center gap-1">
                    Phone Number
                    <span class="relative group cursor-pointer text-neutral-500 font-bold">?
                        <span class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 bg-neutral-800 text-white text-sm rounded px-2 py-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none">
                            Used for account verification and notifications.
                        </span>
                    </span>
                </label>
                <input type="text" name="phone_no" value="{{ current_user.phone_no }}"
                       class="w-full border border-neutral-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-300">
            </div>

            <!-- Account Created On -->
            <div class="relative">
                <label class="block text-neutral-700 font-medium mb-1">Account Created On</label>
                <input type="text" value="{{ current_user.created_at.strftime('%d %b %Y, %I:%M %p') }}" readonly
                       class="w-full border border-neutral-300 rounded-lg px-4 py-2 bg-neutral-100 cursor-not-allowed text-neutral-400">
            </div>

            <button type="submit"
                    class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow transition ml-auto block mt-4">
                Update Account
            </button>

        </div>

        <!-- Recent Activity Card -->
        <div class="bg-white shadow-lg rounded-xl p-6 space-y-4 border border-neutral-200">
            <h2 class="text-xl font-semibold text-neutral-800 mb-4">Recent Activity</h2>

            <!-- Last Login -->
            <p class="flex gap-2 items-center text-neutral-700">
                <i class="lucide lucide-clock text-blue-600"></i>
                <strong>Last Login:</strong>
                {% if current_user.last_login %}
                    {{ current_user.last_login.strftime("%d %b %Y, %I:%M %p") }}
                {% else %}
                    Not Available
                {% endif %}
            </p>

            {% if current_user.last_active_device %}
            <!-- Current Device -->
            <p class="flex gap-2 items-center text-neutral-700 mt-2">
                <i class="lucide lucide-monitor text-green-600"></i>
                <strong>Current Device:</strong>
                {{ current_user.last_active_device.device_type or "Unknown" }} - 
                {{ current_user.last_active_device.device_name or current_user.last_active_device.os or "Unknown OS" }} - 
                {{ current_user.last_active_device.browser or "Unknown Browser" }}
                <span class="ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded-full">This device</span>
            </p>

            <!-- IP Address -->
            <p class="flex gap-2 items-center text-neutral-700 mt-2">
                <i class="lucide lucide-map-pin text-red-600"></i>
                <strong>IP Address:</strong>
                {{ current_user.last_active_device.ip or "Not Available" }}
            </p>
            {% endif %}
        </div>

        <!-- Sign Out Button -->
        <div class="flex justify-between mt-6">
        <a href="{{ url_for('settings.settings') }}" class="px-6 py-3 bg-neutral-600 hover:bg-neutral-700 text-white rounded-lg shadow transition">Get Back!</a>
            <a href="{{ url_for('userAuth.logout') }}"
               class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow transition flex items-center gap-2">
                <i class="lucide lucide-log-out"></i> Sign Out
            </a>
        </div>

    </form>
</div>
{% endblock %}
