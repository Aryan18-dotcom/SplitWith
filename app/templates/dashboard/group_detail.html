{% extends "dashboard/base.html" %}
{% block title %}{{ group.group_title }}{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="flex items-start space-x-5 mb-10">

    {% if group.group_photo %}
        <img src="{{ url_for('static', filename='uploads/groups/' + group.group_photo) }}"
             class="w-20 h-20 rounded-full object-cover shadow-lg">
    {% else %}
        {% set initials = group.group_title.split()[0][0] ~ group.group_title.split()[-1][0] %}
        <div class="w-20 h-20 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 
                    font-bold text-3xl shadow-lg">
            {{ initials.upper() }}
        </div>
    {% endif %}

    <div class="flex-1">
        <h2 class="text-3xl font-extrabold">{{ group.group_title }}</h2>
        <p class="text-neutral-500 mt-1">{{ group.group_description }}</p>

        <div class="mt-3 text-sm text-neutral-600 space-y-1">
            <p><span class="font-semibold">Created:</span> {{ group.created_at | datetimeformat }}</p>
            <p><span class="font-semibold">Creator:</span>
                <span class="text-blue-700 font-semibold">{{ creator.full_name }}</span>
            </p>
        </div>
    </div>
</div>

<!-- SUMMARY SECTION -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-10">

    <!-- Balance -->
    <div class="p-5 bg-white shadow rounded-xl border">
        <h3 class="font-semibold">Your Balance</h3>
        <p class="mt-2 text-xl font-bold 
            {% if final_split > 0 %}text-green-600
            {% elif final_split < 0 %}text-red-600
            {% else %}text-neutral-800{% endif %}
        ">
            ‚Çπ{{ final_split }}
        </p>
    </div>

    <!-- Total Expenses -->
    <div class="p-5 bg-white shadow rounded-xl border">
        <h3 class="font-semibold">Total Expenses</h3>
        <p class="mt-2 text-xl font-bold">‚Çπ{{ total_expenses }}</p>
        <p class="text-neutral-400 text-xs">{{ expenses_count }} transactions</p>
    </div>

    <!-- Members -->
    <div class="p-5 bg-white shadow rounded-xl border">
        <h3 class="font-semibold">Total Members</h3>
        <p class="mt-2 text-xl font-bold">{{ members|length }}</p>
    </div>

</div>

<!-- MEMBERS LIST -->
<div class="bg-white p-6 rounded-xl shadow mb-10 border">
    <h3 class="text-lg font-semibold mb-4">Members ({{ members|length }})</h3>

    <div class="space-y-4">
        {% for m in members %}
        <div class="flex items-center justify-between p-3 bg-neutral-50 rounded-lg shadow">
            <div>
                <p class="font-semibold">{{ m.name }}</p>
                <p class="text-xs text-neutral-500">{{ m.email }}</p>
                <p class="text-xs text-blue-600">{{ m.role }}</p>
            </div>
            <div class="text-xs text-neutral-400">
                Joined: {{ m.joined_at | datetimeformat }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ALL EXPENSES -->
<div class="bg-white p-6 rounded-xl shadow mb-10 border">
    <h3 class="text-lg font-semibold mb-4">All Expenses</h3>

    {% if expenses %}
        <div class="space-y-4">
        {% for e in expenses %}
            <div class="p-4 rounded-lg bg-neutral-50 border shadow">
                <p class="font-semibold">{{ e.title }}</p>
                <p class="text-sm text-neutral-700">‚Çπ{{ e.amount }}</p>
                <p class="text-xs text-neutral-500">{{ e.created_at | datetimeformat }}</p>
                <p class="text-xs mt-1">{{ e.description }}</p>
            </div>
        {% endfor %}
        </div>
    {% else %}
        <p class="text-neutral-500">No expenses added yet.</p>
    {% endif %}
</div>

<!-- SETTLEMENT SECTION -->
<div class="bg-white p-6 rounded-xl shadow mb-10 border">

    <h3 class="text-xl font-bold mb-4 text-neutral-800">üí∞ Final Settlement Summary</h3>

    <!-- TOTAL EXPENSE -->
    <div class="mb-4 p-4 bg-neutral-50 rounded-lg border">
        <p class="font-semibold text-neutral-700 text-lg">üìå Total Group Expense: 
            <span class="text-blue-600 font-bold">‚Çπ{{ total_expenses }}</span>
        </p>
    </div>

    <!-- PAYMENT BREAKDOWN -->
    <div class="mb-4 p-4 bg-neutral-50 rounded-lg border">
        <h4 class="font-semibold text-neutral-800 text-lg mb-2">üßæ Payment Breakdown</h4>

        {% for entry in payment_breakdown %}
            <p class="text-neutral-700 text-base">{{ entry }}</p>
        {% endfor %}
    </div>

    <!-- SHARE HOLDING -->
    <div class="mb-4 p-4 bg-neutral-50 rounded-lg border">
        <h4 class="font-semibold text-neutral-800 text-lg mb-2">üìä Share Holding</h4>

        {% for entry in share_holding %}
            <p class="text-neutral-700 text-base">{{ entry }}</p>
        {% endfor %}
    </div>

    <!-- FINAL SETTLEMENT -->
    <div class="mb-4 p-4 bg-neutral-50 rounded-lg border">
        <h4 class="font-semibold text-neutral-800 text-lg mb-2">üì£ Final Settlement</h4>
        <p class="text-neutral-700 text-base">{{ settlement_message }}</p>
    </div>


<!-- NET BALANCE RESULT -->
<div class="p-4 bg-neutral-100 rounded-lg border">
    <h4 class="font-semibold text-neutral-800 text-lg">üì£ Final Result</h4>

    {% if final_split < 0 %}
        <!-- USER OWES MONEY -->
        <p class="text-red-700 font-bold text-lg mt-2">
            ‚ùå You OWE ‚Çπ{{ final_split | abs }} to 
            <span class="text-blue-700">
                {% for o in you_owe %}
                    {{ o.name }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </span>
        </p>

    {% elif final_split > 0 %}
        <!-- USER WILL RECEIVE MONEY -->
        <p class="text-green-700 font-bold text-lg mt-2">
            ‚úÖ You will RECEIVE ‚Çπ{{ final_split }} from
            <span class="text-blue-700">
                {% for o in owes_you %}
                    {{ o.name }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </span>
        </p>

    {% else %}
        <!-- FULLY SETTLED -->
        <p class="text-neutral-700 font-bold text-lg mt-2">
            ‚úî All Settled ‚Äî Nothing to give or take.
        </p>
    {% endif %}
</div>



</div>


{% endblock %}
